server:
  port: 8080  # 网关端口

spring:
  application:
    name: testhub-gateway  # 服务名称

  # Nacos配置（学习要点：注册中心和配置中心地址）
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848  # Nacos服务地址
        namespace: public  # 命名空间
      config:
        server-addr: localhost:8848
        file-extension: yml

    # Gateway路由配置（学习要点：核心配置）
    gateway:
      # 路由规则
      routes:
        # 认证服务路由
        - id: testhub-auth
          uri: lb://testhub-auth  # lb表示负载均衡，从Nacos获取服务地址
          predicates:
            - Path=/api/auth/**  # 匹配路径：/api/auth/**
          filters:
            - StripPrefix=1  # 去除路径前缀/api

        # 项目服务路由
        - id: testhub-project
          uri: lb://testhub-project
          predicates:
            - Path=/api/project/**
          filters:
            - StripPrefix=1

        # 测试服务路由
        - id: testhub-testcase
          uri: lb://testhub-testcase
          predicates:
            - Path=/api/testcase/**
          filters:
            - StripPrefix=1

      # 全局跨域配置（学习要点：允许前端跨域访问）
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOriginPatterns: "*"  # 允许所有来源（生产环境应限制具体域名）
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600

      # Discovery定位器（学习要点：自动发现Nacos中的服务）
      discovery:
        locator:
          enabled: true  # 启用服务发现
          lower-case-service-id: true  # 服务名小写

  # Redis配置（用于限流）
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      password:  # 如果Redis没有密码，留空
      timeout: 3000ms

# 日志配置
logging:
  level:
    com.testhub.gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG

# 健康检查（学习要点：监控端点）
management:
  endpoints:
    web:
      exposure:
        include: '*'  # 暴露所有监控端点
  endpoint:
    health:
      show-details: always
